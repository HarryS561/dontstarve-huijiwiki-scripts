"use strict";(function(){"use strict";const c=window.SteamDB,u=document.querySelector(".scope-depot"),m=parseInt(u.dataset.depotid,10);let l=u.dataset.defaultTab;if(c.OnExtensionUserdataLoaded(()=>{if(document.querySelector("#subs .package.owned")){const o=document.querySelector("#js-depot-owned");o.hidden=!1}}),document.getElementById(l)===null){const o=document.querySelector(".tabnav-tab");l=o.getAttribute("aria-controls"),o.click()}const r=function(o,n){if(l===o)n();else{const s=document.getElementById(`tab-${o}`);s&&s.addEventListener("tab-shown",n,{once:!0})}};r("files",function(){$(".depot-files").DataTable({initComplete(){$(this).find("tfoot").remove().end().find("tbody").prop("hidden",!1)}}),$(".file-types").DataTable({paging:!1,info:!1})}),r("apps",function(){$("#apps").find("table").DataTable({paging:!1,info:!1,order:[[4,"desc"]]})}),r("subs",function(){$("#subs table").DataTable({paging:!1,info:!1})}),r("manifests",function(){const o=document.querySelector("#manifests #js-filter-manifest-branch");if(!o)return;let n=null,s="dd";const v=c.Storage.Get("manifest-copy-format");document.querySelectorAll(".manifest-copy-format .btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const i=document.querySelector(`.manifest-copy-format .btn[data-type="${s}"]`);i.classList.toggle("btn-info",!1),i.classList.toggle("btn-outline",!0),e.classList.toggle("btn-info",!0),e.classList.toggle("btn-outline",!1),s=e.dataset.type,n?.close(),t.isTrusted&&c.Storage.Set("manifest-copy-format",s)}),e.dataset.type===v&&e.click()});const f=document.querySelectorAll("#manifests .table tbody tr"),b=new Set,w=document.querySelector(".octicon-copy");for(const e of f){const t=e.querySelector(".js-branch")?.textContent??"public";e.dataset.branch=t,b.add(t);const i=e.querySelector(".manifest-copy");i.append(w.cloneNode(!0)),i.addEventListener("click",function(){let d="";const g=e.querySelector("a").textContent,h=(document.querySelector("#apps .app.owned")??document.querySelector("#apps .app"))?.dataset.appid??0,p=t!=="public";if(s==="steam"?(d=`download_depot ${h} ${m} ${g}`,p&&n?.close()):s==="dd"&&(d=`-app ${h} -depot ${m} -manifest ${g}`,p&&(d+=` -beta ${t}`)),navigator.clipboard.writeText(d).then(()=>{this.classList.add("manifest-copied"),setTimeout(()=>this.classList.remove("manifest-copied"),500)},()=>{}),n===null){let S="This is provided for convenience, you need to own this depot. Command may fail in certain conditions.";const a=document.createElement("a");a.className="btn btn-sm",a.style.marginTop="8px",s==="steam"?(a.href="steam://open/console",a.textContent="Open Steam console",p&&(S+=" This command does not support providing branch name.")):s==="dd"&&(a.target="_blank",a.href="https://github.com/SteamRE/DepotDownloader",a.textContent="Get DepotDownloader"),n=c.Alert(S,"Manifest copied"),n.append(a),n.addEventListener("toast-close",()=>{n=null})}})}o.append(...[...b.values()].sort().map(e=>{const t=document.createElement("option");return t.value=e,t.textContent=e,t})),o.addEventListener("change",function(){const e=this.value;if(e==="@@unfiltered"){for(const t of f)t.hidden=!1;return}for(const t of f)t.hidden=t.dataset.branch!==e});const y=document.querySelector("#manifests table tbody");y.querySelectorAll(".timeago").forEach(e=>{TimeAgo.init(e)}),y.removeAttribute("hidden")})})();
